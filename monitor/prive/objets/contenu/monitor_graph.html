#SET{plugins,#EVAL{_DIR_PLUGINS}}

<div id="latence"></div>

[(#REM) Graphique de latence]
<script type="text/javascript">

var chart = dc.lineChart("#latence");
d3.csv("#GET{plugins}monitor/lib/dc.js/latence.csv", function(error, data) {

  
  data.forEach(function(x) {
    x.close = +x.close;
  });

  data = data.slice(0, 200);
 
  var ndx             = crossfilter(data),
      openDimension   = ndx.dimension(function(d) {return parseInt(d.latence);}),
      openGroup       = openDimension.group(),
      monthDimension  = ndx.dimension(function(d) {return new Date(new Date(d.date).setDate(1));}),
      closeGroup      = monthDimension.group().reduce(
        function(p,v) {
          p.push(v.close);
          return p;
        },
        function(p,v) {
          p.splice(p.indexOf(v.close), 1);
          return p;
        },
        function() {
          return [];
        }
      );
  console.log(data);

  chart
    .width(768)
    .height(480)
    .margins({top: 10, right: 50, bottom: 30, left: 50})
    .dimension(monthDimension)
    .group(closeGroup)
    .x(d3.time.scale().domain([new Date("01/01/2014"), new Date("01/01/2015")]))
    .round(d3.time.month.round)
    .xUnits(d3.time.months)
    .elasticY(true);

  dc.renderAll();
});
</script>

<<<<<<< HEAD
<div id="latence"></div>
=======
>>>>>>> bf5cb4fe447401c682da334ed4d5c0998ee919f1

[(#REM) Graphique de latence]
<script type="text/javascript">

// var chart = dc.lineChart("#latence");
// d3.csv("http://galaxie.france-diplomatie.info/spip.php?page=monitor_csv&id_syndic=5&type=ping", function(error, data) {
//     console.log(data);
//     // data.forEach(function(x) {
//     //     x.close = +x.close;
//     // });

//     data = data.slice(0, 200);
      
//     var ndx             = crossfilter(data),
//         openDimension   = ndx.dimension(function(d) {return parseInt(d.valeur);}),
//         openGroup       = openDimension.group(),
//         monthDimension  = ndx.dimension(function(d) {return new Date(new Date(d.maj).setDate(1));}),
//         closeGroup      = monthDimension.group().reduce(
//             function(p,v) {
//               p.push(v.close);
//               return p;
//             },
//             function(p,v) {
//               p.splice(p.indexOf(v.close), 1);
//               return p;
//             },
//             function() {
//               return [];
//             }
//     );

//   chart
//     .width(568)
//     .height(480)
//     .margins({top: 10, right: 10, bottom: 20, left: 10})
//     .dimension(monthDimension)
//     .group(closeGroup)
//     .x(d3.time.scale().domain([new Date("01-01-2014"), new Date("01-01-2015")]))
//     .round(d3.time.month.round)
//     .xUnits(d3.time.months)
//     .elasticY(true);

//   dc.renderAll();
// });


// var chart = dc.lineChart("#latence");
// d3.csv("http://galaxie.france-diplomatie.info/spip.php?page=monitor_csv&id_syndic=5&type=ping", function(error, data) {

//   data.forEach(function(x) {
//     x.valeur = +x.valeur;
//   });

//   var ndx                 = crossfilter(data),
//       runDimension   = ndx.dimension(function(d) {return parseInt(d.valeur);}),
//       speedSumGroup  = ndx.dimension(function(d) {return new Date(new Date(d.maj).setDate(1));});
//       runDimension        = ndx.dimension(function(d) {return +d.valeur;}),
//       speedSumGroup       = runDimension.group()(function(d) {return new Date(new Date(d.maj).setDate(1));});

//   chart
//     .width(768)
//     .height(480)
//     .x(d3.scale.linear().domain([0,20]))
//     .interpolate('step-before')
//     .renderArea(true)
//     .brushOn(false)
//     .renderDataPoints(true)
//     .yAxisLabel("This is the Y Axis!")
//     .dimension(runDimension)
//     .group(speedSumGroup);

//   chart.render();

// });



var margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var parseDate = d3.time.format("%d-%m-%Y %h:%m:%s").parse;

var x = d3.time.scale()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.valeur); });

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("http://galaxie.france-diplomatie.info/spip.php?page=monitor_csv&id_syndic=#ID_SYNDIC&type=ping", function(error, data) {

  data.forEach(function(d) {
    console.log(d);
    d.date = parseDate(d.date);
    d.valeur = +d.valeur;
  });

  x.domain(d3.extent(data, function(d) { return d.date; }));
  y.domain(d3.extent(data, function(d) { return d.valeur; }));

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Price ($)");

  svg.append("path")
      .datum(data)
      .attr("class", "line")
      .attr("d", line);
});
</script>
